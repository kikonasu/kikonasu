<!--
  TRIGGER: capsule_missing_items
  WHEN: User has incomplete capsule wardrobe
  FREQUENCY: Weekly (if gaps exist)
  SUBJECT: "Complete your {{capsuleName}} capsule: {{missingCount}} items to go"
  PREVIEW: "You're {{percentComplete}}% there! Here's what you still need"
-->

<!-- Capsule Progress Banner -->
<tr>
  <td style="background: linear-gradient(135deg, #6366f1 0%, #818cf8 50%, #a5b4fc 100%); padding: 24px; text-align: center;">
    <p style="font-size: 36px; margin: 0 0 8px 0;">&#127912;</p>
    <p style="font-size: 20px; font-weight: 600; color: #ffffff; margin: 0;">
      Capsule Wardrobe Progress
    </p>
    <p style="font-size: 14px; color: rgba(255,255,255,0.9); margin: 8px 0 0 0;">
      {{capsuleName}}
    </p>
  </td>
</tr>

<!-- Main Content -->
<tr>
  <td class="content-section" style="padding: 32px 24px;">

    <!-- Greeting -->
    <h1 class="greeting" style="font-size: 24px; font-weight: 600; color: #1a1a1a; margin: 0 0 16px 0;">
      You're almost there, {{userName}}!
    </h1>

    <p class="body-text" style="font-size: 16px; line-height: 1.6; color: #4a4a4a; margin: 0 0 24px 0;">
      Your <strong>{{capsuleName}}</strong> capsule wardrobe is <strong>{{percentComplete}}% complete</strong>. Just a few more pieces and you'll have a fully curated, versatile collection!
    </p>

    <!-- Progress Bar -->
    <div style="margin: 0 0 24px 0;">
      <table role="presentation" style="width: 100%; border: none; border-spacing: 0;">
        <tr>
          <td style="background-color: #e0e7ff; border-radius: 8px; padding: 0; height: 12px;">
            <div style="background: linear-gradient(135deg, #6366f1 0%, #818cf8 100%); border-radius: 8px; height: 12px; width: {{percentComplete}}%;"></div>
          </td>
        </tr>
      </table>
      <table role="presentation" style="width: 100%; border: none; border-spacing: 0; margin-top: 8px;">
        <tr>
          <td style="font-size: 14px; color: #6b7280;">
            {{itemsOwned}} of {{totalItems}} items
          </td>
          <td style="font-size: 14px; color: #6366f1; text-align: right; font-weight: 600;">
            {{missingCount}} to go
          </td>
        </tr>
      </table>
    </div>

    <!-- What You Have -->
    {{#if ownedItems}}
    <div style="background-color: #f0fdf4; border-radius: 12px; padding: 16px; margin: 0 0 24px 0;">
      <p style="font-size: 14px; font-weight: 600; color: #166534; margin: 0 0 12px 0;">
        &#10003; Items You Have
      </p>
      <table role="presentation" style="width: 100%; border: none; border-spacing: 0;">
        <tr>
          {{#each ownedItems}}
          <td style="width: {{../ownedColumnWidth}}%; padding: 4px; text-align: center; vertical-align: top;">
            <img src="{{this.imageUrl}}" alt="{{this.name}}" style="width: 100%; max-width: 60px; height: auto; border-radius: 8px; border: 2px solid #22c55e;">
            <p style="font-size: 10px; color: #6b7280; margin: 4px 0 0 0;">{{this.name}}</p>
          </td>
          {{/each}}
        </tr>
      </table>
    </div>
    {{/if}}

    <!-- Missing Items -->
    <p style="font-size: 14px; font-weight: 600; color: #374151; text-transform: uppercase; letter-spacing: 0.5px; margin: 0 0 16px 0;">
      &#128269; Items You Still Need
    </p>

    {{#each missingItems}}
    <div style="background-color: #f9fafb; border-radius: 12px; padding: 16px; margin: 0 0 12px 0; border-left: 4px solid #6366f1;">
      <table role="presentation" style="width: 100%; border: none; border-spacing: 0;">
        <tr>
          <td style="vertical-align: top;">
            <p style="font-size: 16px; font-weight: 600; color: #1a1a1a; margin: 0;">{{this.name}}</p>
            <p style="font-size: 13px; color: #6b7280; margin: 4px 0 0 0;">{{this.category}}</p>
            <p style="font-size: 14px; color: #4b5563; margin: 8px 0 0 0;">{{this.description}}</p>
            {{#if this.priceRange}}
            <p style="font-size: 13px; color: #6366f1; margin: 8px 0 0 0;">
              Typical price: {{this.priceRange}}
            </p>
            {{/if}}
          </td>
          <td style="width: 100px; text-align: right; vertical-align: top;">
            {{#if this.isOnWishlist}}
            <span style="background-color: #fce7f3; color: #be185d; font-size: 11px; padding: 4px 8px; border-radius: 4px;">On Wishlist</span>
            {{else}}
            <a href="{{../appUrl}}/wishlist/add?item={{this.id}}" style="color: #6366f1; font-size: 12px; text-decoration: none;">+ Add to Wishlist</a>
            {{/if}}
          </td>
        </tr>
      </table>
    </div>
    {{/each}}

    <!-- Outfit Potential -->
    <div class="highlight-box" style="background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%); border-radius: 12px; padding: 20px; margin: 24px 0; text-align: center;">
      <p style="font-size: 14px; color: #4338ca; margin: 0 0 8px 0;">Complete capsule outfit potential:</p>
      <p style="font-size: 48px; font-weight: 700; color: #4f46e5; margin: 0;">{{totalOutfitPotential}}</p>
      <p style="font-size: 16px; color: #6366f1; margin: 4px 0 0 0;">outfit combinations</p>
    </div>

    <!-- Tips for Completing Capsule -->
    <p style="font-size: 16px; font-weight: 600; color: #1a1a1a; margin: 0 0 16px 0;">
      Tips for completing your capsule:
    </p>

    <table role="presentation" style="width: 100%; border: none; border-spacing: 0; margin: 0 0 24px 0;">
      <tr>
        <td style="padding: 8px 0; font-size: 15px; color: #4a4a4a;">
          <span style="color: #6366f1; margin-right: 8px;">&#8226;</span> Prioritize versatile neutral pieces first
        </td>
      </tr>
      <tr>
        <td style="padding: 8px 0; font-size: 15px; color: #4a4a4a;">
          <span style="color: #6366f1; margin-right: 8px;">&#8226;</span> Look for quality items that will last
        </td>
      </tr>
      <tr>
        <td style="padding: 8px 0; font-size: 15px; color: #4a4a4a;">
          <span style="color: #6366f1; margin-right: 8px;">&#8226;</span> Check your existing wardrobe - you might already have alternatives
        </td>
      </tr>
    </table>

    <!-- CTA -->
    <table role="presentation" style="width: 100%; border: none; border-spacing: 0;">
      <tr>
        <td align="center" style="padding: 8px 0;">
          <a href="{{appUrl}}/capsules/{{capsuleId}}" class="cta-button" style="display: inline-block; background: linear-gradient(135deg, #8B5CF6 0%, #A855F7 100%); color: #ffffff; font-size: 16px; font-weight: 600; padding: 16px 32px; border-radius: 12px; text-decoration: none;">
            View My Capsule
          </a>
        </td>
      </tr>
      <tr>
        <td align="center" style="padding: 8px 0;">
          <a href="{{appUrl}}/capsules/{{capsuleId}}/shopping-list" class="secondary-button" style="display: inline-block; background-color: #f3f4f6; color: #4b5563; font-size: 14px; font-weight: 500; padding: 12px 24px; border-radius: 8px; text-decoration: none;">
            View Shopping List
          </a>
        </td>
      </tr>
    </table>

  </td>
</tr>
